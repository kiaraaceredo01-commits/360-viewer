<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Tour 360 con giroscopio</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    html, body { height: 100%; margin: 0; background:#000; }
    .ui {
      position: fixed; inset: auto 0 0 0; display:flex; gap:.5rem;
      padding: .75rem; justify-content:center; background: linear-gradient(transparent, rgba(0,0,0,.35));
      z-index: 10; font-family: system-ui, sans-serif;
    }
    .btn {
      border: 0; border-radius: .75rem; padding: .6rem .9rem; font-size: .95rem;
      background: rgba(255,255,255,.15); color: #fff; backdrop-filter: blur(6px); cursor: pointer;
    }
    .btn:active { transform: scale(.98); }
    .hint {
      position: fixed; top: .75rem; left: 50%; transform: translateX(-50%);
      color: #fff; font-size: .9rem; background: rgba(0,0,0,.4); padding: .4rem .6rem; border-radius: .6rem;
    }
  </style>
</head>
<body>

  <!-- UI mínima -->
  <div class="hint">Arrastrá con el dedo o mové el celu</div>
  <div class="ui">
    <button id="gyroBtn" class="btn">Activar giroscopio</button>
    <button id="resetBtn" class="btn">Recentrar vista</button>
  </div>

  <!-- ESCENA -->
  <a-scene
    renderer="colorManagement: true; physicallyCorrectLights: true"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"  <!-- lo manejamos a mano -->
  >
    <!-- SKY con tu foto 360 equirectangular -->
    <!-- Cambiá src por la ruta real de tu pano: -->
    <a-sky id="sky" src="FOTO.jpg" rotation="0 -90 0"></a-sky>

    <!-- Cámara + controles: mouse/touch + 'magic window' (giroscopio) -->
    <a-entity id="rig">
      <a-entity id="cam" camera position="0 1.6 0"
        look-controls="enabled: true; reverseMouseDrag: false; magicWindowTrackingEnabled: true">
      </a-entity>
    </a-entity>
  </a-scene>

  <script>
    // iOS 13+ exige pedir permiso para usar el giroscopio:
    async function enableGyro() {
      try {
        const needsPermission = typeof DeviceOrientationEvent !== 'undefined'
          && typeof DeviceOrientationEvent.requestPermission === 'function';
        if (needsPermission) {
          const res = await DeviceOrientationEvent.requestPermission();
          if (res !== 'granted') { alert('Permiso denegado para el giroscopio.'); return; }
        }
        // Forzá a A-Frame a leer orientación (ya está activado via look-controls)
        document.querySelector('#gyroBtn').textContent = 'Giroscopio activo';
      } catch (e) {
        console.warn(e);
        alert('Tu navegador no permite habilitar el giroscopio automáticamente.');
      }
    }

    // Recentrar vista: resetea rotación de la cámara
    function recenter() {
      const cam = document.querySelector('#cam');
      cam.setAttribute('rotation', {x: 0, y: 0, z: 0});
      // A-Frame también expone rotation vía object3D:
      if (cam.object3D) cam.object3D.rotation.set(0, 0, 0);
    }

    // Botones
    document.getElementById('gyroBtn').addEventListener('click', enableGyro);
    document.getElementById('resetBtn').addEventListener('click', recenter);

    // Si querés usar un VIDEO 360 en vez de imagen:
    // 1) Agregá en <a-scene> un <video id="vid" src="assets/video360.mp4" loop autoplay playsinline crossorigin="anonymous"></video>
    // 2) Reemplazá <a-sky> por: <a-videosphere src="#vid"></a-videosphere>
    // 3) En iOS, el autoplay puede requerir interacción: agregá un botón "Reproducir".
  </script>
</body>
</html>